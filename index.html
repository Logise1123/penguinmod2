
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta property="theme-color" content="#51D3F4">
  <link rel="icon" href="https://penguinmod.com/favicon.ico" />
  <title>PenguinMod - Home</title>
  <meta name="title" content="PenguinMod - Home">
  <meta name="description" content="Featured projects and community .pmp uploads for PenguinMod GitHub">
  <style>
    :root {
      --bg-dark: #181c21;
      --bg-dark2: #23232e;
      --bg-box: #242534;
      --pm-blue: #51D3F4;
      --pm-yellow: #FFE74C;
      --pm-pink: #FF66C7;
      --pm-green: #45ff89;
      --pm-text: #fff;
      --pm-text2: #b0bada;
      --section-title: #ffec3b;
      --sep-border: #292b3d;
      --shadow-card: 0 0 18px #37ecf390, 0 0px 3px #ffe74c71;
      --card-radius: 14px;
      --btn-bg: #272844;
      --btn-yellow: #ffe74c;
      --btn-pink: #ff75d9;
      --btn-blue: #51d3f4;
      --header-gradient: linear-gradient(90deg,#51d3f4 0%,#51d3f4 100%);
    }
    body {margin: 0;font-family: "Segoe UI", "Montserrat", "Arial", sans-serif;background: var(--bg-dark);color: var(--pm-text);min-height: 100vh;}
    header {background: var(--header-gradient);color: #222;font-size: 2.2em;padding: 1.1em 0 0.6em 0;text-align: center;font-weight: 700;text-shadow: 1px 2px 26px #0de4ff38;letter-spacing: 1px;border-bottom: 5px solid var(--pm-blue);position: relative;}
    .subtitle {display: block;color: #265c71;font-size: 1.0em;font-weight: 600;text-shadow: none;letter-spacing: .02em;margin-top: 3px;margin-bottom: 3px;text-align: center;}
    nav {background: var(--bg-dark2);border-bottom: 2px solid var(--sep-border);display: flex;align-items: center;padding: 0.4em 0 0.3em 0;justify-content: center;gap: 12px;margin-bottom: 8px;}
    nav button {background: var(--btn-bg);color: var(--pm-blue);border: none;border-radius: 14px;margin: 0 4px;padding: 0.75em 2.2em;font-size: 1.09em;font-weight: 600;cursor: pointer;letter-spacing: 0.07em;box-shadow: 0 0px 12px #1117, 0 1.5px 8px #51d3f422;transition: background 0.15s, color 0.17s;}
    nav button.active {background: var(--pm-yellow);color: #181c21;box-shadow: 0 2px 18px #ffe74c72, 0 0px 6px #ffe74c94;}
    main {width: 100vw;max-width: 1260px;margin: 0 auto;padding: 0 0 1em 0;min-height: 500px;}
    .guidelines-warning-box {padding: 8px;border-radius: 4px;border: 1px solid rgb(255, 153, 0);background: rgb(255, 217, 0, 0.5);color: #181c21;margin: 1.6em auto 2em auto;width: 94vw;max-width: 820px;font-weight: 500;font-size: 1.02em;text-align: center;}
    .section-projects {margin-top: 22px;width: 98vw;max-width: 1120px;margin-left: auto;margin-right: auto;}
    .section-title {color: var(--section-title);font-size: 1.41em;font-weight: 700;letter-spacing: .04em;margin-left: 18px;text-shadow: 0 2px 16px #ffe74c19;display: flex;align-items: center;gap: 13px;}
    .carousel-section {margin-bottom: 38px;}
    .carousel-header {display: flex;justify-content: space-between;align-items: baseline;margin: 0 0 2 0;}
    .carousel-scroll {overflow-x: auto;display: flex;align-items: stretch;gap: 18px;padding-bottom: 0.7em;scrollbar-color: var(--pm-blue) #232332;scrollbar-width: thin;}
    .card-project {background: var(--bg-box);border-radius: var(--card-radius);box-shadow: var(--shadow-card);min-width: 170px;max-width: 210px;width: 190px;padding-bottom: 4px;margin: 6px 0 12px 0;display: flex;flex-direction: column;align-items: center;overflow: hidden;cursor: pointer;position: relative;border: 2px solid transparent;transition: box-shadow 0.17s, border 0.2s;}
    .card-project.latest { border-color: var(--pm-blue);}
    .card-project.featured { border-color: var(--pm-pink);}
    .card-project.games { border-color: var(--pm-green);}
    .card-project:hover {box-shadow: 0 4px 22px #ffe74c77, 0 2px 18px #51d3f470;border-color: var(--pm-yellow);z-index: 2;}
    .card-thumb {width: 98%;aspect-ratio: 1/1;min-height: 109px;max-height: 148px;object-fit: cover;margin-top: 6px;background: #2e3549;border-radius: 8px;box-shadow: 0 0 8px #37ecf316;border: 2.8px solid #51d3f4;image-rendering: pixelated;display:block;}
    .card-title {font-weight: 700;font-size: 1em;color: var(--pm-yellow);padding: 7px 12px 3px 12px;width: 95%;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;text-align: center;letter-spacing: .01em;font-family: "Segoe UI", "Montserrat", Arial, sans-serif;text-shadow: 0 2px 9px #ffe74c40;}
    .card-meta {text-align: center;font-size: 0.93em;color: var(--pm-blue);font-weight: 500;opacity: 0.82;}
    .card-author {color: var(--pm-pink);font-weight: 600;font-size: 0.98em;margin-right: 3px;}
    .card-desc {font-size: 0.94em;padding: 0 11px 0 11px;color: var(--pm-text2);margin-bottom: 7px;min-height: 2.1em;line-height: 1.22em;text-align: center;}
    .download-btn {background: var(--pm-blue);color: #19191e;border: none;border-radius: 12px;font-weight: bold;font-size: 1em;padding: 0.6em 1.2em;margin-bottom: 7px;transition: background 0.12s, color 0.13s;box-shadow: 0 1px 12px #51d3f475;cursor: pointer;font-family: 'Segoe UI',Arial,sans-serif;width: 88%;}
    .download-btn:hover { background: var(--pm-yellow); color: #222;}
    .vote-btn {margin:3px 5px 12px 5px;padding: 0.45em 1.4em;border:none;border-radius:8px;font-size:1.08em;font-weight: bold;box-shadow:0 2px 8px #51d3f43c;cursor:pointer;transition: background .15s,color .1s;}
    .vote-btn.like {background: #45ff89;color:#242534;}
    .vote-btn.dislike{background: #FF66C7;color:#fff;}
    .vote-btn[disabled]{opacity:0.65;cursor:default;}
    .popup-vote-count {font-size:1.08em;margin-bottom:8px;color:#ffe74c;font-weight:600;}
    .popup-vote-status {font-size:.98em;margin-bottom:8px;color:#51d3f4;}
    .popup-bg {display: none;position: fixed;top: 0; left: 0; right: 0; bottom: 0;background: rgba(20,20,30,0.93);z-index: 120;align-items: center;justify-content: center;}
    .popup {background: #232842;color: #fafafa;max-width: 410px;width: 95vw;border-radius: 15px;box-shadow: 0 4px 70px #1ec9ff33, 0 2px 18px #ffe74c55;padding: 2em;text-align: center;position: relative;border: 3px solid var(--pm-blue);margin: 1.2em;}
    .popup img {width: 58%;max-height: 160px;object-fit: contain;margin-bottom: 1em;border-radius: 13px;box-shadow: 0 1px 18px #1ec9ff33;background:#28314e;image-rendering: pixelated;}
    .popup button.close {position: absolute;top: 8px;right: 8px;background: var(--pm-yellow);border: none;border-radius: 50%;width: 32px;height: 32px;font-size: 1.2em;color: #232332;cursor: pointer;font-weight: bold;transition: background 0.16s;box-shadow: 0 0 8px #ffe80022;}
    .popup button.close:hover { background: var(--pm-pink); color: #fff;}
    .popup .file-title {margin-top: 0.13em;margin-bottom: .18em;color: var(--pm-yellow);font-size: 1.16em;font-weight: bold;text-shadow: 0 2px 8px #ffe74c30;}
    .popup .file-meta {margin-bottom:0.7em;}
    .popup .file-desc {margin-bottom:1.11em;}
    #uploadSec, #homeSec, #accountSec, #loginSec {display: none;background: var(--bg-box);border-radius: 21px;min-height: 200px;box-shadow: 0 2px 30px #08131e99;margin: 2.2em auto 2em auto;padding: 2.2em 1.1em 2em 1.1em;max-width: 950px;}
    label {font-weight: 600;color: var(--pm-blue);margin-bottom: .2em;display: block;font-size:1em;}
    input[type="text"], input[type="password"], textarea {width: 97.5%;padding: 0.65em 8px;border: 1.7px solid var(--pm-yellow);border-radius: 9px;font-size: 1em;outline: none;margin-bottom: .25em;background: #222637;color: var(--pm-yellow);font-weight: 500;font-family: inherit;}
    textarea {min-height:40px;resize:vertical;}
    input[type="file"]{margin-top:.12em;font-family:inherit;color:#f9f9f9;}
    ::file-selector-button {background: var(--pm-blue);color: #222;border: none;padding: 6px 19px;border-radius: 8px;font-family: inherit;font-weight: bold;cursor: pointer;transition: background 0.13s;}
    ::file-selector-button:hover{background:var(--pm-pink);}
    .form-actions{text-align:center;}
    .form-actions button {padding: 0.78em 2.3em;font-size: 1.07em;background: var(--pm-blue);color:#19191e;border: none;border-radius: 9px;font-weight: bold;cursor: pointer;transition: background .16s, color 0.13s;font-family: inherit;margin-top: .32em;}
    .form-actions button:hover {background:var(--pm-yellow);color:#211;}
    .msg {margin:1.19em 0 0 0;color:var(--pm-yellow);font-weight:700;font-size:1.08em;text-align:center;}
    #tokeninfo{background:#1f293c;color:var(--pm-yellow);padding:.8em;border-radius:7px;font-size:1em;margin-bottom:1em;border:1.8px solid #3d404d;}
    .error-message{color:var(--pm-pink);background:#2e1d36;padding:.5em .85em;border-radius:6px;margin:.6em 0 1em 0;text-align:center;}
    .account-area {text-align:center;margin:1.2em 0 .5em 0}
    .account-area b {color:var(--pm-yellow);}
    .account-btns {display:inline-block;margin:0.6em 0;}
    .account-btns button {margin: 0 .3em;padding: 0.6em 1.4em;background: var(--pm-blue);color:#19191e;font-weight:600;border-radius: 6px;font-size:1em;}
    .account-btns button:hover { background: var(--pm-yellow);}
    @media (max-width: 900px){
      main{max-width:100vw;padding-left:0;padding-right:0;}
      .section-projects{max-width:100vw;}
      .carousel-scroll{gap:12px;}
      #uploadSec, #homeSec, #accountSec, #loginSec{margin:14px 0;padding: 0.5em 0.2em 1.4em 0.2em;}
      .section-title{font-size:1em;}
    }
    .carousel-scroll {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .carousel-scroll::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://penguinmod.com/favicon.ico" alt="PenguinMod" style="height:1.1em;vertical-align:middle;margin-right:0.4em;">
    PenguinMod
    <span class="subtitle">Second server for when the first falls down (FAN MADE)</span>
  </header>
  <nav>
    <button id="btnHome" class="active">Home</button>
    <button id="btnUpload">Upload Project</button>
    <button id="btnAccount">Account</button>
  </nav>
  <div class="guidelines-warning-box">
    Please only upload projects, thumbnails, and information that comply with the PenguinMod community guidelines.<br>
    <b>Do not upload offensive, NSFW, or spam content.</b>
  </div>
  <main>
    <section id="homeSec">
      <div id="accountBar" class="account-area"></div>
      <div class="section-projects">
        <div class="carousel-section" id="latestSection">
          <div class="carousel-header">
            <div class="section-title">üåü Latest featured projects</div>
          </div>
          <div class="carousel-scroll" id="latestCarousel"></div>
        </div>
        <div class="carousel-section" id="featuredSection">
          <div class="carousel-header">
            <div class="section-title" style="color:#ff66c7">üíñ Projects people want Featured</div>
          </div>
          <div class="carousel-scroll" id="featuredCarousel"></div>
        </div>
        <div class="carousel-section" id="gamesSection">
          <div class="carousel-header">
            <div class="section-title" style="color:#45ff89">üéÆ Projects marked as #games</div>
          </div>
          <div class="carousel-scroll" id="gamesCarousel"></div>
        </div>
        <div class="carousel-section" id="recentSection">
          <div class="carousel-header">
            <div class="section-title" style="color:#ffe74c">üïë Recent projects</div>
          </div>
          <div class="carousel-scroll" id="recentCarousel"></div>
        </div>
      </div>
      <div id="noFilesMsg" style="margin-top:1em;text-align:center;color:var(--pm-text2);font-size:1.07em;"></div>
      <div id="errHome" class="error-message" style="display:none"></div>
    </section>
    <!-- Las secciones de upload, account, login, register siguen igual sin cambios: puedes poner tu HTML original aqu√≠ -->
    <section id="uploadSec"></section>
    <section id="accountSec"></section>
    <section id="loginSec"></section>
    <section id="registerSec" style="display:none;"></section>
  </main>
  <div class="popup-bg" id="popupBg">
    <div class="popup" id="popupCard">
      <button class="close" onclick="closePopup()">√ó</button>
      <img id="popupThumb" src="" alt="Thumbnail">
      <div class="file-title" id="popupTitle"></div>
      <div class="file-meta">
        <span id="popupAuthor"></span> ‚Ä¢ <span id="popupTime"></span>
      </div>
      <div class="file-desc" id="popupDesc"></div>
      <div class="popup-vote-count" id="popupVoteCount"></div>
      <div class="popup-vote-status" id="popupVoteStatus"></div>
      <button class="vote-btn like" id="popupLikeBtn">üëç Like</button>
      <button class="vote-btn dislike" id="popupDislikeBtn">üëé Dislike</button>
      <button class="download-btn" id="popupDownloadBtn">Download .pmp</button>
    </div>
  </div>
  <footer style="background:var(--bg-dark2);color:var(--pm-text2);text-align:center;padding:2em 0 1em 0;margin-top:3em;font-size:1em;">
    PenguinMod is not affiliated with Scratch, TurboWarp, the Scratch Team, or the Scratch Foundation.
    <div style="display:flex;gap:18px;justify-content:center;margin-top:1.3em;flex-wrap:wrap;">
      <div><b>Website</b><br>
        <a href="https://studio.penguinmod.com/editor.html" class="carousel-link" style="font-size:.99em;">Editor</a><br>
        <a href="https://studio.penguinmod.com/credits.html" class="carousel-link" style="font-size:.99em;">Credits</a><br>
        <a href="https://github.com/PenguinMod/" class="carousel-link" style="font-size:.99em;">Source</a>
      </div>
      <div><b>Community</b><br>
        <a href="https://github.com/PenguinMod/PenguinMod-Home/issues" class="carousel-link" style="font-size:.99em;">Report an issue</a><br>
        <a href="https://wiki.penguinmod.com/wiki/Main_Page" class="carousel-link" style="font-size:.99em;">Community Wiki</a>
      </div>
      <div><b>Donate</b><br>
        <a href="/donate" class="carousel-link" style="font-size:.99em;">PenguinMod</a><br>
        <a href="https://github.com/sponsors/GarboMuffin" class="carousel-link" style="font-size:.99em;">TurboWarp</a>
      </div>
    </div>
  </footer>
  <script>
    // --- VOTOS POR LOCALSTORAGE ---
    function getVotes() {
      return JSON.parse(localStorage.getItem('penguinmod_votes')||'{}');
    }
    function saveVotes(votes) {
      localStorage.setItem('penguinmod_votes', JSON.stringify(votes));
    }
    function getVoteForProject(id) {
      return getVotes()[id] || null;
    }
    function voteProject(id, type) {
      let votes = getVotes();
      votes[id] = type; // 'like' o 'dislike'
      saveVotes(votes);
    }
    function countVotes(arr, id) {
      let voteData = JSON.parse(localStorage.getItem('penguinmod_votes_data')||'{}');
      let like = 0, dislike = 0;
      if (voteData[id]) {
        like = voteData[id].like || 0;
        dislike = voteData[id].dislike || 0;
      }
      let myVote = getVoteForProject(id);
      if(myVote == 'like') like ++;
      if(myVote == 'dislike') dislike ++;
      return {like, dislike, score: like-dislike, total:like+dislike};
    }
    // --- CUENTAS Y SESI√ìN ---
    let account = null;
    function getAccountLocal() {
      try {
        account = JSON.parse(localStorage.getItem("penguinmod_account")||"{}");
        return account && account.username ? account : null;
      } catch(e) { return null; }
    }
    function updateAccountBar() {
      const bar = document.getElementById("accountBar");
      if(getAccountLocal()) {
        bar.innerHTML = 'Signed in as <b>'+account.username+'</b> <button onclick="logout()">Logout</button>';
      } else {
        bar.innerHTML = 'Not signed in. <button onclick="showLogin()">Login</button> <button onclick="showRegister()">Register</button>';
      }
    }
    // --- NAVEGACI√ìN ---
    function showSection(sec) {
      document.getElementById("homeSec").style.display = sec==="home" ? "block" : "none";
      document.getElementById("uploadSec").style.display = sec==="upload" ? "block" : "none";
      document.getElementById("accountSec").style.display = sec==="account" ? "block" : "none";
      document.getElementById("loginSec").style.display = "none";
      document.getElementById("registerSec").style.display = "none";
      document.getElementById("btnHome").classList.toggle("active", sec==="home");
      document.getElementById("btnUpload").classList.toggle("active", sec==="upload");
      document.getElementById("btnAccount").classList.toggle("active", sec==="account");
      document.getElementById("errHome").style.display = "none";
      if(sec==="home") { updateAccountBar(); listProjects(); }
      // ... otras secciones igual ...
    }
    document.getElementById("btnHome").onclick = ()=>showSection("home");
    document.getElementById("btnUpload").onclick = ()=>showSection("upload");
    document.getElementById("btnAccount").onclick = ()=>showSection("account");
    // --- PROYECTOS ---
    const WORKER_API = "https://royal-term-e73b.arielcapdevilagarcia.workers.dev/";
    const METAFILE = "proyectos.json";
    async function workerDownloadProjects() {
      try {
        let r = await fetch(WORKER_API + "?file="+encodeURIComponent(METAFILE));
        if(!r.ok) return [];
        const obj = await r.json();
        if (Array.isArray(obj)) return obj;
        if (typeof obj === "object" && obj.content && obj.encoding==="base64") {
          const txt = atob(obj.content.replace(/\n/g,''));
          try {
            const arr = JSON.parse(txt);
            if(Array.isArray(arr)) return arr;
            return [];
          } catch (e) { return []; }
        }
        return [];
      } catch(e) { return []; }
    }
    async function listProjects() {
      let arr=[];
      let msg = document.getElementById("noFilesMsg");
      let errMsg = document.getElementById("errHome");
      document.getElementById("latestCarousel").innerHTML = "";
      document.getElementById("featuredCarousel").innerHTML = "";
      document.getElementById("gamesCarousel").innerHTML = "";
      document.getElementById("recentCarousel").innerHTML = "";
      msg.innerHTML = "Loading...";
      try { arr = await workerDownloadProjects(); } catch(e) {
        msg.innerHTML = "No projects or could not connect.<br>"+e;
        errMsg.style.display = "block";
        errMsg.innerText = e;
        return;
      }
      if(!Array.isArray(arr)||arr.length===0) {
        msg.innerHTML = "No projects yet. Be the first to upload!";
        return;
      }
      msg.innerHTML = "";
      arr.forEach(function(proj){
        let c = countVotes(arr, proj.id);
        proj.votes_like = c.like;
        proj.votes_dislike = c.dislike;
        proj.votes_total = c.total;
      });
      // Filtrar seg√∫n tus reglas:
      let latest = arr.filter(p=>p.votes_total>25).slice(0,14);
      let featured = arr.filter(p=>p.votes_total>10 && p.votes_total<=25).slice(0,12);
      let games = arr.filter(
        p=>((typeof p.tags==="string"?p.tags:Array.isArray(p.tags)?p.tags.join():"").toLowerCase().includes("game"))
      ).slice(0,12);
      let recent = arr.slice(0,10);
      renderCarousel(latest, document.getElementById("latestCarousel"), "latest");
      renderCarousel(featured, document.getElementById("featuredCarousel"), "featured");
      renderCarousel(games, document.getElementById("gamesCarousel"), "games");
      renderCarousel(recent, document.getElementById("recentCarousel"), "recent");
    }
    function renderCarousel(arr, cont, styleClass) {
      if(!arr || !arr.length) { cont.innerHTML = "<div style='color:#464f64;text-align:center;font-size:1em;padding:1em;'>No projects</div>"; return; }
      cont.innerHTML = "";
      arr.forEach(function(proj){
        const card = document.createElement("div");
        card.className = "card-project " + styleClass;
        card.onclick = ()=>showDownloadPopup(proj.id, arr);
        const img = document.createElement("img");
        img.className = "card-thumb";
        img.src = proj.thumb;
        img.alt = "Thumbnail";
        const titleDiv = document.createElement("div");
        titleDiv.className = "card-title";
        titleDiv.innerText = proj.title;
        const meta = document.createElement("div");
        meta.className = "card-meta";
        meta.innerHTML = `<span class="card-author">${proj.author ? proj.author : "?"}</span>
         ‚Ä¢ <span>${proj.time ? formatShortDate(proj.time) : ""}</span>`;
        const descDiv = document.createElement("div");
        descDiv.className = "card-desc";
        descDiv.innerText = proj.desc.length>62?proj.desc.slice(0,62)+"‚Ä¶":proj.desc;
        card.appendChild(img);
        card.appendChild(titleDiv);
        card.appendChild(meta);
        card.appendChild(descDiv);
        cont.appendChild(card);
      });
    }
    function formatShortDate(ts){
      if(!ts) return "";
      let d = new Date(ts);
      return d.toLocaleDateString([],{month:"short",day:"numeric"}) +
        " " + d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});
    }
    // --- POPUP ---
    let currentProj = null, currentArr=null;
    function updatePopupVotesDisplay(proj) {
      let c = countVotes([], proj.id);
      let myVote = getVoteForProject(proj.id);
      document.getElementById('popupVoteCount').innerText = `üëç ${c.like}  üëé ${c.dislike}  (${c.total} votes)`;
      document.getElementById('popupVoteStatus').innerText = (myVote==='like' ? "You liked this." : myVote==='dislike'?"You disliked this.":"You haven't voted.");
      document.getElementById('popupLikeBtn').disabled = myVote==='like';
      document.getElementById('popupDislikeBtn').disabled = myVote==='dislike';
    }
    function showDownloadPopup(id, arr) {
      const p = (arr||[]).find(x=>x.id===id);
      if(!p) return;
      currentProj = p;
      currentArr = arr;
      document.getElementById("popupThumb").src = p.thumb;
      document.getElementById("popupTitle").innerText = p.title;
      document.getElementById("popupAuthor").innerText = p.author||"Anonymous";
      document.getElementById("popupTime").innerText = formatShortDate(p.time||Date.now());
      document.getElementById("popupDesc").innerText = p.desc;
      updatePopupVotesDisplay(p);
      document.getElementById("popupBg").style.display = "flex";
    }
    document.getElementById("popupLikeBtn").onclick = function(ev){
      if(!currentProj) return;
      voteProject(currentProj.id, 'like');
      let d = JSON.parse(localStorage.getItem('penguinmod_votes_data')||'{}');
      d[currentProj.id] = d[currentProj.id]||{like:0,dislike:0};
      d[currentProj.id].like = (d[currentProj.id].like||0)+1;
      localStorage.setItem('penguinmod_votes_data', JSON.stringify(d)); // DEMO
      updatePopupVotesDisplay(currentProj);
      listProjects();
    }
    document.getElementById("popupDislikeBtn").onclick = function(ev){
      if(!currentProj) return;
      voteProject(currentProj.id, 'dislike');
      let d = JSON.parse(localStorage.getItem('penguinmod_votes_data')||'{}');
      d[currentProj.id] = d[currentProj.id]||{like:0,dislike:0};
      d[currentProj.id].dislike = (d[currentProj.id].dislike||0)+1;
      localStorage.setItem('penguinmod_votes_data', JSON.stringify(d)); // DEMO
      updatePopupVotesDisplay(currentProj);
      listProjects();
    }
    document.getElementById("popupDownloadBtn").onclick = function(){
      if(!currentProj) return;
      downloadPMPviaWorker(currentProj.pmpFile, currentProj.pmpName||"penguinmod-project.pmp");
    }
    function closePopup() {
      document.getElementById("popupBg").style.display = "none";
      currentProj = null; currentArr = null;
    }
    document.getElementById("popupBg").onclick = function(ev){
      if(ev.target===this) closePopup();
    }
    // --- DESCARGA .PMP ---
    async function downloadPMPviaWorker(pmpFile, filename) {
      try {
        let resp = await fetch(WORKER_API + "?file=" + encodeURIComponent(pmpFile));
        if(resp.ok) {
          let blob = await resp.blob();
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          setTimeout(()=>a.remove(),99);
        }else{
          alert("Could not download the file.");
        }
      }catch(e){
        alert("Could not download the file.");
      }
    }
    showSection("home");
  </script>
</body>
</html>
